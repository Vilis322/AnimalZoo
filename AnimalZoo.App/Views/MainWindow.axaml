<?xml version="1.0" encoding="utf-8"?>
<Window
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    x:Class="AnimalZoo.App.Views.MainWindow"
    Width="900" Height="600"
    Title="Animal Zoo"
    mc:Ignorable="d">

  <Grid RowDefinitions="Auto,* ,Auto" ColumnDefinitions="*,2*">
    <!-- HEADER -->
    <TextBlock Grid.ColumnSpan="2" Margin="12" FontSize="20" FontWeight="SemiBold"
               Text="Animal Zoo" />

    <!-- LEFT: Animals list -->
    <StackPanel Grid.Row="1" Grid.Column="0" Margin="12" Spacing="8">
      <TextBlock Text="Animals" FontWeight="SemiBold" />
      <ListBox ItemsSource="{Binding Animals}"
               SelectedItem="{Binding SelectedAnimal}"
               Height="350">
        <ListBox.ItemTemplate>
          <DataTemplate>
            <StackPanel Orientation="Horizontal" Spacing="8">
              <TextBlock Text="{Binding Name}" />
              <TextBlock Text="(" Opacity="0.6"/>
              <TextBlock Text="{Binding Age}" Opacity="0.6"/>
              <TextBlock Text=" y.o.)" Opacity="0.6"/>
            </StackPanel>
          </DataTemplate>
        </ListBox.ItemTemplate>
      </ListBox>

      <StackPanel Orientation="Horizontal" Spacing="8">
        <Button Content="Add Animal" Click="OnAddAnimalClick" />
        <Button Content="Remove Animal" Command="{Binding RemoveAnimalCommand}" />
      </StackPanel>
    </StackPanel>

    <!-- RIGHT: Details + Actions -->
    <StackPanel Grid.Row="1" Grid.Column="1" Margin="12" Spacing="10">
      <TextBlock Text="Details" FontWeight="SemiBold" />

      <!-- Animal image (auto from CurrentImagePath) -->
      <Border Padding="6" BorderBrush="#EEE" BorderThickness="1" CornerRadius="6" Margin="0,0,0,6">
        <Image Source="{Binding CurrentImage}"
               Height="160"
               Stretch="Uniform"
               HorizontalAlignment="Center"/>
      </Border>

      <Border Padding="10" BorderBrush="#DDD" BorderThickness="1" CornerRadius="6">
        <!-- spacer column to align values -->
        <Grid ColumnDefinitions="Auto,10,*" RowDefinitions="Auto,Auto,Auto">
          <TextBlock Grid.Row="0" Grid.Column="0" Text="Name:"/>
          <TextBlock Grid.Row="0" Grid.Column="2" Text="{Binding SelectedAnimal.Name}"/>

          <TextBlock Grid.Row="1" Grid.Column="0" Text="Age:"/>
          <TextBlock Grid.Row="1" Grid.Column="2" Text="{Binding SelectedAnimal.Age}"/>

          <TextBlock Grid.Row="2" Grid.Column="0" Text="State:"/>
          <TextBlock Grid.Row="2" Grid.Column="2" Text="{Binding SelectedAnimal.DisplayState}"/>
        </Grid>
      </Border>

      <StackPanel Orientation="Horizontal" Spacing="8">
        <Button Content="Make Sound" Command="{Binding MakeSoundCommand}" />
        <Button Content="Crazy Action" Command="{Binding CrazyActionCommand}" />
        <Button Content="Toggle Fly (Bird only)" Command="{Binding ToggleFlyCommand}" />
      </StackPanel>

      <!-- FEED with embedded clear button -->
      <Grid ColumnDefinitions="Auto,Auto" RowDefinitions="Auto">
        <Grid>
          <TextBox Width="260"
                   Watermark="Food to feed..."
                   Text="{Binding FoodInput, Mode=TwoWay}" />
          <!-- overlay clear button in the same cell -->
          <Button Content="Ã—"
                  HorizontalAlignment="Right"
                  VerticalAlignment="Center"
                  Margin="0,0,6,0"
                  Padding="6,0"
                  Command="{Binding ClearFoodCommand}"
                  ToolTip.Tip="Clear input" />
        </Grid>
        <Button Grid.Column="1"
                Content="Feed"
                Margin="8,0,0,0"
                Command="{Binding FeedCommand}" />
      </Grid>

      <!-- LOG header with actions -->
      <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Spacing="8" Margin="0,10,0,0">
        <TextBlock Text="Log" FontWeight="SemiBold" />
        <Button Content="Delete selected"
                Command="{Binding RemoveLogEntryByValueCommand}"
                CommandParameter="{Binding SelectedLogEntry}"
                IsEnabled="{Binding SelectedLogEntry, Converter={x:Static ObjectConverters.IsNotNull}}"/>
        <Button Content="Clear log" Command="{Binding ClearLogCommand}" />
      </StackPanel>

      <!-- LOG list with context menu per item -->
      <ListBox ItemsSource="{Binding LogEntries}"
               Height="160"
               SelectedItem="{Binding SelectedLogEntry}">
        <ListBox.ItemTemplate>
          <DataTemplate>
            <StackPanel>
              <TextBlock Text="{Binding .}" TextWrapping="Wrap" />
              <StackPanel.ContextMenu>
                <ContextMenu>
                  <MenuItem Header="Delete this entry"
                            Command="{Binding DataContext.RemoveLogEntryByValueCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                            CommandParameter="{Binding .}" />
                </ContextMenu>
              </StackPanel.ContextMenu>
            </StackPanel>
          </DataTemplate>
        </ListBox.ItemTemplate>
      </ListBox>
    </StackPanel>

    <!-- FOOTER -->
    <TextBlock Grid.Row="2" Grid.ColumnSpan="2" Margin="12"
               Opacity="0.7"
               Text="Tips: Select an animal, watch image change with its mood. Right-click a log entry to delete it." />
  </Grid>
</Window>
