<?xml version="1.0" encoding="utf-8"?>
<Window
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    x:Class="AnimalZoo.App.Views.MainWindow"
    Width="980" Height="720"
    Title="Animal Zoo"
    mc:Ignorable="d">

  <Grid RowDefinitions="Auto,* ,Auto" ColumnDefinitions="*,2*">
    <!-- HEADER -->
    <TextBlock Grid.ColumnSpan="2" Margin="12" FontSize="20" FontWeight="SemiBold"
               Text="Animal Zoo" />

    <!-- LEFT: Animals list + actions -->
    <StackPanel Grid.Row="1" Grid.Column="0" Margin="12" Spacing="8">
      <TextBlock Text="{Binding TextAnimalsHeader}" FontWeight="SemiBold" />
      <ListBox ItemsSource="{Binding Animals}"
               SelectedItem="{Binding SelectedAnimal}"
               MaxHeight="380">
        <ListBox.ItemTemplate>
          <DataTemplate>
            <Border BorderBrush="#333" BorderThickness="0,0,0,1" Padding="4,6">
              <StackPanel Orientation="Horizontal" Spacing="8">
                <TextBlock Text="{Binding Name}" />
                <TextBlock Text="(" Opacity="0.6"/>
                <TextBlock Text="{Binding Age}" Opacity="0.6"/>
                <!-- CHANGED: localized age suffix instead of hardcoded ' y.o.)' -->
                <TextBlock Opacity="0.6"
                           Text="{Binding DataContext.TextAgeListSuffix,
                                          RelativeSource={RelativeSource AncestorType=Window}}"/>
              </StackPanel>
            </Border>
          </DataTemplate>
        </ListBox.ItemTemplate>
      </ListBox>

      <StackPanel Orientation="Horizontal" Spacing="8">
        <Button MinWidth="110" Click="OnAddAnimalClick">
          <TextBlock Text="{Binding TextAddAnimal}" TextAlignment="Center" TextWrapping="Wrap"/>
        </Button>
        <Button MinWidth="140" Command="{Binding RemoveAnimalCommand}">
          <TextBlock Text="{Binding TextRemoveAnimal}" TextAlignment="Center" TextWrapping="Wrap"/>
        </Button>
      </StackPanel>

      <!-- Enclosure actions -->
      <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,8,0,0">
        <Button MinWidth="160" Command="{Binding DropFoodCommand}">
          <TextBlock Text="{Binding TextDropFoodFull}" TextAlignment="Center" TextWrapping="Wrap"/>
        </Button>
        <Button MinWidth="220" Command="{Binding RefreshStatsCommand}">
          <TextBlock Text="{Binding TextRefreshStatsFull}" TextAlignment="Center" TextWrapping="Wrap"/>
        </Button>
      </StackPanel>
    </StackPanel>

    <!-- RIGHT: Details + Actions + Stats -->
    <StackPanel Grid.Row="1" Grid.Column="1" Margin="12" Spacing="10">
      <TextBlock Text="{Binding TextDetailsHeader}" FontWeight="SemiBold" />

      <!-- Toggle IDs + Language switch row -->
      <Grid ColumnDefinitions="Auto,*,Auto">
        <Button Grid.Column="0"
                Command="{Binding ToggleIdListCommand}"
                HorizontalAlignment="Left"
                MinWidth="120">
          <TextBlock Text="{Binding TextToggleIds}" TextAlignment="Center" TextWrapping="Wrap"/>
        </Button>
        <Border Grid.Column="1"/>
        <!-- Language ComboBox (vertical list of languages) -->
        <ComboBox Grid.Column="2"
                  ItemsSource="{Binding LanguageOptions}"
                  SelectedItem="{Binding SelectedLanguageOption, Mode=TwoWay}"
                  MinWidth="80"
                  HorizontalAlignment="Right"
                  ToolTip.Tip="Change language">
          <ComboBox.ItemTemplate>
            <DataTemplate>
              <TextBlock Text="{Binding Display}" />
            </DataTemplate>
          </ComboBox.ItemTemplate>
        </ComboBox>
      </Grid>

      <!-- IDs panel (scrollable, collapsible) -->
      <Border IsVisible="{Binding IsIdListVisible}"
              BorderBrush="#444" BorderThickness="1" CornerRadius="6"
              Padding="8" Background="#101010" >
        <Grid RowDefinitions="Auto,*">
          <TextBlock Text="{Binding TextAnimalIdsHeader}" FontWeight="SemiBold" Margin="0,0,0,6"/>
          <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" MaxHeight="180">
            <ItemsControl ItemsSource="{Binding AnimalIds}">
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <Border BorderBrush="#333" BorderThickness="0,0,0,1" Padding="2,4">
                    <TextBlock Text="{Binding .}" TextWrapping="Wrap"/>
                  </Border>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </ScrollViewer>
        </Grid>
      </Border>

      <!-- Animal image -->
      <Border Padding="6" BorderBrush="#EEE" BorderThickness="1" CornerRadius="6" Margin="0,0,0,6">
        <Image Source="{Binding CurrentImage}"
               Height="160"
               Stretch="Uniform"
               HorizontalAlignment="Center"/>
      </Border>

      <!-- DETAILS CARD -->
      <Border Padding="10" BorderBrush="#DDD" BorderThickness="1" CornerRadius="6">
        <!-- CHANGED: added an extra row for Type (between Name and Age) -->
        <Grid ColumnDefinitions="Auto,10,*" RowDefinitions="Auto,Auto,Auto,Auto">
          <TextBlock Grid.Row="0" Grid.Column="0" Text="{Binding TextNameColon}"/>
          <TextBlock Grid.Row="0" Grid.Column="2" Text="{Binding SelectedAnimal.Name}"/>

          <!-- NEW: Type row -->
          <TextBlock Grid.Row="1" Grid.Column="0"
                     Text="{Binding Labels.Type, StringFormat='{}{0}:'}"/>
          <TextBlock Grid.Row="1" Grid.Column="2"
                     Text="{Binding SelectedAnimalTypeL10n}"/>

          <!-- moved Age/State one row down -->
          <TextBlock Grid.Row="2" Grid.Column="0" Text="{Binding TextAgeColon}"/>
          <TextBlock Grid.Row="2" Grid.Column="2" Text="{Binding SelectedAnimal.Age}"/>

          <TextBlock Grid.Row="3" Grid.Column="0" Text="{Binding TextStateColon}"/>
          <!-- CHANGED earlier: localized state line (name removed; shows mood + fly status if applicable) -->
          <TextBlock Grid.Row="3" Grid.Column="2" Text="{Binding SelectedAnimalStateL10n}"/>
        </Grid>
      </Border>

      <StackPanel Orientation="Horizontal" Spacing="8">
        <Button MinWidth="120" Command="{Binding MakeSoundCommand}">
          <TextBlock Text="{Binding TextMakeSound}" TextAlignment="Center" TextWrapping="Wrap"/>
        </Button>
        <Button MinWidth="120" Command="{Binding CrazyActionCommand}">
          <TextBlock Text="{Binding TextCrazyAction}" TextAlignment="Center" TextWrapping="Wrap"/>
        </Button>
        <Button MinWidth="150" Command="{Binding ToggleFlyCommand}">
          <TextBlock Text="{Binding TextToggleFly}" TextAlignment="Center" TextWrapping="Wrap"/>
        </Button>
      </StackPanel>

      <!-- FEED with embedded clear button -->
      <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto">
        <Grid>
          <TextBox
                   Watermark="{Binding TextFoodLabel}"
                   Text="{Binding FoodInput, Mode=TwoWay}" />
          <Button
                  HorizontalAlignment="Right"
                  VerticalAlignment="Center"
                  Margin="0,0,6,0"
                  Padding="6,0"
                  Command="{Binding ClearFoodCommand}"
                  ToolTip.Tip="Clear input">
            <TextBlock Text="Ã—"/>
          </Button>
        </Grid>
        <Button Grid.Column="1"
                Margin="8,0,0,0"
                Command="{Binding FeedCommand}"
                MinWidth="120">
          <TextBlock Text="{Binding TextFeed}" TextAlignment="Center" TextWrapping="Wrap"/>
        </Button>
      </Grid>

      <!-- LOG action row -->
      <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Spacing="8" Margin="0,10,0,0">
        <TextBlock Text="{Binding TextLogHeader}" FontWeight="SemiBold" />
        <Button MinWidth="120"
                Command="{Binding RemoveLogEntryByValueCommand}"
                CommandParameter="{Binding SelectedLogEntry}">
          <TextBlock Text="{Binding TextDeleteSelected}" TextAlignment="Center" TextWrapping="Wrap"/>
        </Button>
        <Button MinWidth="100" Command="{Binding ClearLogCommand}">
          <TextBlock Text="{Binding TextClearLog}" TextAlignment="Center" TextWrapping="Wrap"/>
        </Button>
      </StackPanel>

      <!-- LOG list -->
      <ListBox ItemsSource="{Binding LogEntries}"
               SelectedItem="{Binding SelectedLogEntry}"
               MaxHeight="160">
        <ListBox.ItemTemplate>
          <DataTemplate>
            <Border BorderBrush="#333" BorderThickness="0,0,0,1" Padding="6,6">
              <TextBlock Text="{Binding .}" TextWrapping="Wrap" />
            </Border>
          </DataTemplate>
        </ListBox.ItemTemplate>
      </ListBox>

      <!-- STATS -->
      <TextBlock Text="{Binding TextStatsHeader}" FontWeight="SemiBold" Margin="0,8,0,0"/>

      <!-- Scrollable stats block -->
      <!-- CHANGED: slightly smaller fixed height to keep the frame above the bottom; scroll remains enabled -->
      <Border Padding="8" BorderBrush="#EEE" BorderThickness="1" CornerRadius="6" Height="220">
        <ScrollViewer VerticalScrollBarVisibility="Auto">
          <StackPanel Spacing="6">

            <!-- Header -->
            <Grid ColumnDefinitions="2*,*,*" Margin="0,0,0,4">
              <TextBlock Grid.Column="0" Text="{Binding Labels.Type}" FontWeight="SemiBold" d:Text="Type"/>
              <TextBlock Grid.Column="1" Text="{Binding Labels.Count}" FontWeight="SemiBold" d:Text="Count"/>
              <TextBlock Grid.Column="2" Text="{Binding Labels.AverageAge}" FontWeight="SemiBold" d:Text="Average age"/>
            </Grid>

            <!-- Rows with horizontal separators -->
            <ItemsControl ItemsSource="{Binding ByTypeStats}">
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <Border BorderBrush="#333" BorderThickness="0,0,0,1" Padding="2,4">
                    <Grid ColumnDefinitions="2*,*,*">
                      <TextBlock Grid.Column="0" Text="{Binding Type}"/>
                      <TextBlock Grid.Column="1" Text="{Binding Count}"/>
                      <TextBlock Grid.Column="2" Text="{Binding AverageAge, StringFormat='{}{0:F1}'}"/>
                    </Grid>
                  </Border>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>

            <!-- Hungry list -->
            <TextBlock Text="{Binding TextHungryHeader}" FontWeight="SemiBold" Margin="0,8,0,0"/>
            <ItemsControl ItemsSource="{Binding HungryStats}">
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <Border BorderBrush="#333" BorderThickness="0,0,0,1" Padding="2,4">
                    <TextBlock Text="{Binding .}" TextWrapping="Wrap"/>
                  </Border>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>

            <!-- Oldest -->
            <TextBlock Text="{Binding TextOldestHeader}" FontWeight="SemiBold" Margin="0,8,0,0"/>
            <Border BorderBrush="#333" BorderThickness="0,0,0,1" Padding="2,4">
              <TextBlock Text="{Binding OldestStat}" TextWrapping="Wrap"/>
            </Border>

          </StackPanel>
        </ScrollViewer>
      </Border>
    </StackPanel>

    <!-- FOOTER -->
    <TextBlock Grid.Row="2" Grid.ColumnSpan="2" Margin="12"
               Opacity="0.7"
               Text="{Binding TextFooterTips}" />
  </Grid>
</Window>
